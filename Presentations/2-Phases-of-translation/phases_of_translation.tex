% !TeX TS-program = xelatex

\documentclass[compress]{beamer}

\beamertemplatenavigationsymbolsempty
\setbeamertemplate{headline}{}

% ==== Packages section ============================

\usepackage{xltxtra}
\usepackage[main=russian,english]{babel}

\setmainfont{DejaVu Serif}
\setsansfont{DejaVu Sans}
\setmonofont{Fira Mono}

\usepackage[export]{adjustbox}
\usepackage{tikz}

\usepackage[newfloat]{minted}
\usemintedstyle{borland}
\SetupFloatingEnvironment{listing}{name=\tiny Листинг}

\usepackage{fancyvrb}
\usepackage{fvextra}

\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    filecolor=magenta,
    urlcolor=cyan,
}

\usepackage{tikz}
\usetikzlibrary{positioning}

\usepackage{makecell}

% ==== Beamer customization section ================

\title{Фазы трансляции}
\subtitle{Введение в разработку на C++}
\author{Пыхов~Олег~Александрович\inst{1} \\ \texttt{pyhovoleg31@gmail.com}}
\institute{
    \inst{1}%
    ООО~"Прософт-Системы"
}
\date{2024}
\titlegraphic{
    \includegraphics[scale=0.1,valign=t]{Presentations/images/university-logo.png}
    \includegraphics[scale=0.3,valign=t]{Presentations/images/prosoft-logo.png}
}
\logo{
    \begin{tikzpicture}[overlay,remember picture]
        \node[left=0.2cm] at (current page.32){
            \includegraphics[scale=0.15,valign=t]{Presentations/images/prosoft-logo.png}
            \includegraphics[scale=0.05,valign=t]{Presentations/images/university-logo.png}
        };
    \end{tikzpicture}
}

\setbeamertemplate{footline}[frame number]

\begin{document}

\frame[plain]{\titlepage}

\begin{frame}

    \frametitle{Фазы трансляции}

    \begin{enumerate}

        \item Mapping source characters

        \item Splicing lines

        \item Lexing

        \item \textbf{Preprocessing (препроцессор)}

        \item Determining common string literal encodings

        \item Concatenating string literals

        \item \textbf{Compiling (компиляция)}

        \item Instantiating templates

        \item \textbf{Linking (линковка)}

    \end{enumerate}

    \vfill

    Более подробно:
    \href{https://en.cppreference.com/w/cpp/language/translation_phases}{eng},
    \href{https://ru.cppreference.com/w/cpp/language/translation_phases}{ru}.

\end{frame}

\begin{frame}

    \frametitle{Компиляторы C++}

    \begin{itemize}

        \item \texttt{\textbf{g++}} от GNU Compiler Collection (GCC)

        \item \texttt{\textbf{clang++}} от от Low Level Virtual Machine (LLVM)

        \item Microsoft Visual C++ (MSVC)

        \item и др.

    \end{itemize}

\end{frame}

\begin{frame}

    \frametitle{Препроцессор}

    \centering

    \begin{tikzpicture}[node distance = 5cm]

        \node (source1) {
            \includegraphics[width=1.7cm]{Presentations/images/source_code.png}
        };
        \node (source2) [right=of source1] {
            \includegraphics[width=1.7cm]{Presentations/images/source_code.png}
        };

        \draw[->, ultra thick] (source1.east) -- (source2.west)
            node[midway, above] {\makecell[l]{Работа\\препроцессора}};

    \end{tikzpicture}

\end{frame}

\begin{frame}[fragile]

    \frametitle{Препроцессор: директива \\ \texttt{\#define}}

    \begin{columns}[T]

        \begin{column}{0.5\textwidth}

            \begin{listing}[H]
                \inputminted[
                    frame=single,
                    fontsize=\scriptsize,
                    linenos,
                    xleftmargin=1em
                ]{cpp}
                    {Presentations/2-Phases-of-translation/defines-example.cpp}
                \caption{\tiny defines-example.cpp}
            \end{listing}

        \end{column}

        \begin{column}{0.5\textwidth}

            \begin{Verbatim}[
                frame=single,
                fontsize=\tiny,
                commandchars=\\\{\},
                breaklines=true,
                breakanywhere=true,
            ]
$ \textbf{g++ \colorbox{yellow}{-E} defines-example.cpp}
# 0 "defines-example.cpp"
# 0 "<built-in>"
# 0 "<command-line>"
# 1 "/usr/include/stdc-predef.h" 1 3 4
# 0 "<command-line>" 2
# 1 "defines-example.cpp"




int main() \{
    int i = 1 + 32;
    return 0;
\}
            \end{Verbatim}

        \end{column}

    \end{columns}

\end{frame}

\begin{frame}[fragile]

    \frametitle{Препроцессор: директива \\ \texttt{\#define}}

    \begin{columns}[T]

        \begin{column}{0.5\textwidth}

            \begin{listing}[H]
                \inputminted[
                    frame=single,
                    fontsize=\scriptsize,
                    linenos,
                    xleftmargin=1em
                ]{cpp}
                    {Presentations/2-Phases-of-translation/defines-param-example.cpp}
                \caption{\tiny define-parameters.cpp}
            \end{listing}

        \end{column}

        \begin{column}{0.5\textwidth}

            \begin{Verbatim}[
                frame=single,
                fontsize=\scriptsize,
                commandchars=\\\{\},
                breaklines=true,
                breakanywhere=true,
            ]
$ \textbf{g++ define-parameters.cpp}
$ \textbf{./a.out}
1, 3.14, text
            \end{Verbatim}

        \end{column}

    \end{columns}

\end{frame}

\begin{frame}[fragile]

    \frametitle{Препроцессор: директива \\ \texttt{\#include}}

    \begin{columns}[T]

        \begin{column}{0.5\textwidth}

            \begin{listing}[H]
                \inputminted[
                    frame=single,
                    fontsize=\scriptsize,
                    linenos,
                    xleftmargin=1em
                ]{cpp}
                    {Presentations/2-Phases-of-translation/include-header.h}
                \caption{\tiny include-header.h}
            \end{listing}

            \begin{listing}[H]
                \inputminted[
                    frame=single,
                    fontsize=\scriptsize,
                    linenos,
                    xleftmargin=1em
                ]{cpp}
                    {Presentations/2-Phases-of-translation/include-source.cpp}
                \caption{\tiny include-source.cpp}
            \end{listing}

        \end{column}

        \begin{column}{0.5\textwidth}

            \begin{Verbatim}[
                frame=single,
                fontsize=\tiny,
                commandchars=\\\{\},
                breaklines=true,
                breakanywhere=true,
            ]
$ \textbf{g++ -E include-source.cpp}
# 0 "include-source.cpp"
# 0 "<built-in>"
# 0 "<command-line>"
# 1 "/usr/include/stdc-predef.h" 1 3 4
# 0 "<command-line>" 2
# 1 "include-source.cpp"
# 1 "include-header.h" 1
\colorbox{yellow}{int a = 0;}
# 2 "include-source.cpp" 2

int main() \{
    int b = a;
    return 0;
\}
            \end{Verbatim}

        \end{column}

    \end{columns}

\end{frame}

\begin{frame}[fragile]

    \frametitle{Препроцессор: директива \\ \texttt{\#pragma}}

    \begin{columns}[T]

        \begin{column}{0.5\textwidth}

            \begin{listing}[H]
                \inputminted[
                    frame=single,
                    fontsize=\scriptsize,
                    linenos,
                    xleftmargin=1em
                ]{cpp}
                    {Presentations/2-Phases-of-translation/pragma-example.h}
                \caption{\tiny pragma-example.h}
            \end{listing}

            \begin{listing}[H]
                \inputminted[
                    frame=single,
                    fontsize=\scriptsize,
                    linenos,
                    xleftmargin=1em
                ]{cpp}
                    {Presentations/2-Phases-of-translation/pragma-example.cpp}
                \caption{\tiny pragma-example.cpp}
            \end{listing}

        \end{column}

        \begin{column}{0.5\textwidth}

            \begin{Verbatim}[
                frame=single,
                fontsize=\tiny,
                commandchars=\\\{\},
                breaklines=true,
                breakanywhere=true,
            ]
$ \textbf{g++ -E pragma-example.cpp}
# 0 "pragma-example.cpp"
# 0 "<built-in>"
# 0 "<command-line>"
# 1 "/usr/include/stdc-predef.h" 1 3 4
# 0 "<command-line>" 2
# 1 "pragma-example.cpp"
# 1 "pragma-example.h" 1


const auto PI = 3.14;
# 2 "pragma-example.cpp" 2




int main() \{
    auto pi = PI;
\}
            \end{Verbatim}

        \end{column}

    \end{columns}

\end{frame}

\begin{frame}

    \frametitle{Компиляция}

    \centering

    \begin{tikzpicture}[node distance = 5cm]

        \node (source) {
            \includegraphics[width=1.7cm]{Presentations/images/source_code.png}
        };
        \node (binary) [right=of source] {
            \includegraphics[width=1.7cm]{Presentations/images/binary-file.png}
        };

        \draw[->, ultra thick] (source.east) -- (binary.west)
            node[midway, above] {Компиляция};

    \end{tikzpicture}

\end{frame}

\end{document}
